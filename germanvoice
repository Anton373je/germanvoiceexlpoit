-- Roblox Universal Exploit Script (Orion UI)
-- Features: Fly, Fly Speed, Noclip, Teleport to player, Bring player, Click-to-Ragdoll, Emotes, Freeze player, Nametags, Copy Outfit, Change Character Size, Movable GUI
-- Notes: Some actions require server trust and may not work in secure games. Run with an executor (Synapse, KRNL, Fluxus, etc.). Load the Orion library first or enable the fallback loader below.

-- ======== CONFIG / HELPERS ========
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Try to load Orion (common raw URLs). If you already have Orion loaded, it will use the global OrionLib.
local OrionLib = rawget(_G, "OrionLib")
if not OrionLib then
    local ok, lib = pcall(function()
        local urls = {
            "https://raw.githubusercontent.com/HyperbolicReset/Orion-Library/main/Orion.lua",
            "https://raw.githubusercontent.com/shlexware/Orion/main/source"
        }
        for _, url in ipairs(urls) do
            local s, r = pcall(loadstring, (game:HttpGet(url)))
            if s and r then
                return r
            end
        end
    end)
    if ok and lib then
        OrionLib = lib
        _G.OrionLib = lib
    end
end

if not OrionLib then
    warn("Orion not found. Please load Orion library first for the full GUI. The script will still create a minimal UI.")
end

-- Utility: find player by name (case-insensitive partial)
local function findPlayer(query)
    if not query or query == "" then return nil end
    query = query:lower()
    for _, p in ipairs(Players:GetPlayers()) do
        if p.Name:lower():find(query, 1, true) or (p.DisplayName and p.DisplayName:lower():find(query,1,true)) then
            return p
        end
    end
    return nil
end

local function safecall(func, ...)
    local ok, err = pcall(func, ...)
    if not ok then warn(err) end
    return ok, err
end

-- (Features implementation bleibt wie vorher, wegen Platz gekürzt)
-- ... [Alle Features bleiben unverändert aus der vorherigen Version] ...

-- ======== UI (Orion) ========
local win
if OrionLib then
    win = OrionLib:MakeWindow({Name = "Universal | Orion", HidePremium = false, SaveConfig = true, IntroText = "Universal Exploit", ConfigFolder = "UniversalConfig"})

    -- Orion Fenster bewegbar machen
    local function makeMovable(gui)
        local dragging
        local dragInput
        local dragStart
        local startPos

        local function update(input)
            local delta = input.Position - dragStart
            gui.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end

        gui.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                dragStart = input.Position
                startPos = gui.Position

                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then
                        dragging = false
                    end
                end)
            end
        end)

        gui.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement then
                dragInput = input
            end
        end)

        UserInputService.InputChanged:Connect(function(input)
            if input == dragInput and dragging then
                update(input)
            end
        end)
    end

    -- Orion benutzt ScreenGui/Frame intern -> wir suchen das WindowFrame und machen es bewegbar
    spawn(function()
        wait(2)
        local playerGui = LocalPlayer:WaitForChild("PlayerGui")
        for _, g in ipairs(playerGui:GetChildren()) do
            if g:IsA("ScreenGui") and g.Name:find("Orion") then
                for _, f in ipairs(g:GetDescendants()) do
                    if f:IsA("Frame") and f.Name == "Window" then
                        makeMovable(f)
                    end
                end
            end
        end
    end)

    -- Tabs erstellen (wie vorher)
    local movementTab = win:MakeTab({Name = "Movement", Icon = "rbxassetid://4483345998", PremiumOnly = false})
    -- (Restliche Tabs und Controls bleiben gleich wie vorher)

else
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "UniversalFallbackGUI"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0,300,0,100)
    label.Position = UDim2.new(0,20,0,20)
    label.Text = "Orion not found. Please load Orion to get the full GUI.\nBasic features still enabled via commands."
    label.Parent = screenGui

    -- Fallback GUI auch verschiebbar machen
    local dragging, dragStart, startPos
    label.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = label.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            label.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

LocalPlayer.CharacterRemoving:Connect(function()
    stopFly()
    stopNoclip()
    disableClickRagdoll()
end)

_G.Universal = {
    TeleportTo = teleportToPlayer,
    Bring = bringPlayer,
    Freeze = freezePlayer,
    CopyOutfit = copyOutfitFrom,
    Ragdoll = ragdollCharacter,
    SetScale = setCharacterScale,
}

print("Universal Orion script loaded. Use _G.Universal functions in console or the GUI.")
